@model ArticleViewModel
@{
	ViewData["Title"] = "Home Page";
}
<div class="row">
	<div class="col-xs-12">
		<h2>@Model.Article.Title</h2>
		<form method="POST">
			<div class="form-group">
				<label for="title">Title</label>
				<input type="text" class="form-control" id="title" name="Article.Title" placeholder="Title" value="@Model.Article.Title">
			</div>
			<div class="form-group">
				<label for="authorId">Author</label>
				<select class="form-control" asp-for="@Model.Article.AuthorId" asp-items="@Model.Authors"></select> 
			</div>
			<div class="form-group">
				<label for="date">Date</label>
				<input type="text" id="Article.date" name="Article.date" class="form-control" value="@Model.Article.Date">
			</div>
			<div class="form-group">
				<label for="tags">Tags</label>
				<div id="tag-container"></div>
				<input id="add-tag" class="form-control" style="float:left;" />
				<input type="hidden" name="Article.Tags" id="Article.Tags" />
			</div>
			<div class="form-group" style="clear:both;">
				<label for="body">Body</label>
				<textarea name="Article.Body" id="body" class="form-control">@Model.Article.Body</textarea>
			</div>
			<input type="hidden" name="Article.id" value="@Model.Article.Id" />
			<button type="submit" class="btn btn-default">Submit</button>
			@if(Model.Article.Id > 0) {
			<button type="submit" name="delete" class="btn btn-danger">Delete</button>
			}
		</form>

	</div>
</div>

@section Scripts
{
<script>
	var APP = {};
	APP.selectedTags = [];
	@if(Model.Article.Tags != null && Model.Article.Tags.Count > 0) {
		foreach(var tag in Model.Article.Tags) {
	<text>
	APP.selectedTags.push(@tag.Id);
	</text>
		}
	}
	APP.allTags = [];
	@if(Model.AllTags != null && Model.AllTags.Count > 0) {
		foreach(var tag in Model.AllTags) {
	<text>
	APP.allTags.push({id:@tag.Id, name:"@tag.Name"});
	</text>
		}
	}
	function addTag(tag) {
		APP.$tagcontainer.append("<div class='tag'>" + tag + "</div>");
	}

	function redrawTags() {
		for(var i=0, count=APP.selectedTags.length; i<count; i++) {
			addTag(APP.selectedTags[i]);
		}
	}

	$(document).ready(function () {
		APP.$tags = $("#tags");
		APP.$tagcontainer = $("#tag-container");
		APP.$tags.empty();
		redrawTags();
	});
</script>
}

<style>
#tag-container {margin:10px 0 10px;}
.tag {padding:2px 20px 2px 5px; border:1px solid #aaa; float:left; margin-right:10px; border-radius:4px;}
</style>